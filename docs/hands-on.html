<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Hands-On | Intro to SQL for Querying Databases</title>
  <meta name="description" content="3 Hands-On | Intro to SQL for Querying Databases" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Hands-On | Intro to SQL for Querying Databases" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://ucdavisdatalab.github.io/workshop_intro_to_sql/" />
  
  
  <meta name="github-repo" content="ucdavisdatalab/workshop_intro_to_sql" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Hands-On | Intro to SQL for Querying Databases" />
  
  
  

<meta name="author" content="Nicholas Alonzo" />
<meta name="author" content="Michele Tobias" />


<meta name="date" content="2022-04-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-background-and-setup.html"/>
<link rel="next" href="conclusion.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />












</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://datalab.ucdavis.edu/">
  <img src="https://datalab.ucdavis.edu/wp-content/uploads/2019/07/datalab-logo-full-color-rgb-1.png" style="height: 100%; width: 100%; object-fit: contain" />
</a></li>
<li><a href="./" style="font-size: 18px">Intro to SQL for Querying Databases</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="1" data-path="concepts.html"><a href="concepts.html"><i class="fa fa-check"></i><b>1</b> Concepts</a>
<ul>
<li class="chapter" data-level="1.1" data-path="concepts.html"><a href="concepts.html#what-is-a-relational-database"><i class="fa fa-check"></i><b>1.1</b> What is a Relational Database?</a></li>
<li class="chapter" data-level="1.2" data-path="concepts.html"><a href="concepts.html#what-is-sql"><i class="fa fa-check"></i><b>1.2</b> What is SQL?</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="concepts.html"><a href="concepts.html#the-sql-query-blueprint"><i class="fa fa-check"></i><b>1.2.1</b> The SQL Query Blueprint</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="concepts.html"><a href="concepts.html#what-is-a-relational-database-management-system-rdbms"><i class="fa fa-check"></i><b>1.3</b> What is a Relational Database Management System (RDBMS)?</a></li>
<li class="chapter" data-level="1.4" data-path="concepts.html"><a href="concepts.html#why-should-you-learn-to-work-with-databases-and-sql"><i class="fa fa-check"></i><b>1.4</b> Why should you learn to work with databases and SQL?</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="concepts.html"><a href="concepts.html#youre-already-doing-this"><i class="fa fa-check"></i><b>1.4.1</b> You’re Already Doing This!</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-background-and-setup.html"><a href="data-background-and-setup.html"><i class="fa fa-check"></i><b>2</b> Data Background and Setup</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-background-and-setup.html"><a href="data-background-and-setup.html#data-background"><i class="fa fa-check"></i><b>2.1</b> Data Background</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="data-background-and-setup.html"><a href="data-background-and-setup.html#entity-relationship-diagram-erd"><i class="fa fa-check"></i><b>2.1.1</b> Entity Relationship Diagram (ERD)</a></li>
<li class="chapter" data-level="2.1.2" data-path="data-background-and-setup.html"><a href="data-background-and-setup.html#data-definitions"><i class="fa fa-check"></i><b>2.1.2</b> Data Definitions</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data-background-and-setup.html"><a href="data-background-and-setup.html#data-setup"><i class="fa fa-check"></i><b>2.2</b> Data Setup</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="data-background-and-setup.html"><a href="data-background-and-setup.html#the-sqlitestudio-interface"><i class="fa fa-check"></i><b>2.2.1</b> The SQLiteStudio Interface</a></li>
<li class="chapter" data-level="2.2.2" data-path="data-background-and-setup.html"><a href="data-background-and-setup.html#load-the-sql-file"><i class="fa fa-check"></i><b>2.2.2</b> Load the SQL File</a></li>
<li class="chapter" data-level="2.2.3" data-path="data-background-and-setup.html"><a href="data-background-and-setup.html#load-the-database"><i class="fa fa-check"></i><b>2.2.3</b> Load the Database</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="hands-on.html"><a href="hands-on.html"><i class="fa fa-check"></i><b>3</b> Hands-On</a>
<ul>
<li class="chapter" data-level="3.1" data-path="hands-on.html"><a href="hands-on.html#viewing-data"><i class="fa fa-check"></i><b>3.1</b> Viewing Data</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="hands-on.html"><a href="hands-on.html#select-from"><i class="fa fa-check"></i><b>3.1.1</b> SELECT &amp; FROM</a></li>
<li class="chapter" data-level="3.1.2" data-path="hands-on.html"><a href="hands-on.html#selecting-columns"><i class="fa fa-check"></i><b>3.1.2</b> Selecting Columns</a></li>
<li class="chapter" data-level="3.1.3" data-path="hands-on.html"><a href="hands-on.html#unique-values"><i class="fa fa-check"></i><b>3.1.3</b> Unique Values</a></li>
<li class="chapter" data-level="3.1.4" data-path="hands-on.html"><a href="hands-on.html#ordering-results"><i class="fa fa-check"></i><b>3.1.4</b> Ordering Results</a></li>
<li class="chapter" data-level="3.1.5" data-path="hands-on.html"><a href="hands-on.html#limiting-number-of-rows"><i class="fa fa-check"></i><b>3.1.5</b> Limiting Number of Rows</a></li>
<li class="chapter" data-level="3.1.6" data-path="hands-on.html"><a href="hands-on.html#commenting"><i class="fa fa-check"></i><b>3.1.6</b> Commenting</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="hands-on.html"><a href="hands-on.html#filtering-data"><i class="fa fa-check"></i><b>3.2</b> Filtering Data</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="hands-on.html"><a href="hands-on.html#and-or-operators"><i class="fa fa-check"></i><b>3.2.1</b> AND &amp; OR Operators</a></li>
<li class="chapter" data-level="3.2.2" data-path="hands-on.html"><a href="hands-on.html#in-operator"><i class="fa fa-check"></i><b>3.2.2</b> IN Operator</a></li>
<li class="chapter" data-level="3.2.3" data-path="hands-on.html"><a href="hands-on.html#between-operator"><i class="fa fa-check"></i><b>3.2.3</b> BETWEEN Operator</a></li>
<li class="chapter" data-level="3.2.4" data-path="hands-on.html"><a href="hands-on.html#like-operator"><i class="fa fa-check"></i><b>3.2.4</b> LIKE Operator</a></li>
<li class="chapter" data-level="3.2.5" data-path="hands-on.html"><a href="hands-on.html#is-null-operator"><i class="fa fa-check"></i><b>3.2.5</b> IS NULL Operator</a></li>
<li class="chapter" data-level="3.2.6" data-path="hands-on.html"><a href="hands-on.html#not-operator"><i class="fa fa-check"></i><b>3.2.6</b> NOT Operator</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="hands-on.html"><a href="hands-on.html#aggretating-data"><i class="fa fa-check"></i><b>3.3</b> Aggretating Data</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="hands-on.html"><a href="hands-on.html#count"><i class="fa fa-check"></i><b>3.3.1</b> Count</a></li>
<li class="chapter" data-level="3.3.2" data-path="hands-on.html"><a href="hands-on.html#average"><i class="fa fa-check"></i><b>3.3.2</b> Average</a></li>
<li class="chapter" data-level="3.3.3" data-path="hands-on.html"><a href="hands-on.html#sum"><i class="fa fa-check"></i><b>3.3.3</b> Sum</a></li>
<li class="chapter" data-level="3.3.4" data-path="hands-on.html"><a href="hands-on.html#grouping-data"><i class="fa fa-check"></i><b>3.3.4</b> Grouping Data</a></li>
<li class="chapter" data-level="3.3.5" data-path="hands-on.html"><a href="hands-on.html#having"><i class="fa fa-check"></i><b>3.3.5</b> Having</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="hands-on.html"><a href="hands-on.html#joining-data"><i class="fa fa-check"></i><b>3.4</b> Joining Data</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="hands-on.html"><a href="hands-on.html#join-types"><i class="fa fa-check"></i><b>3.4.1</b> JOIN Types</a></li>
<li class="chapter" data-level="3.4.2" data-path="hands-on.html"><a href="hands-on.html#join-steps"><i class="fa fa-check"></i><b>3.4.2</b> JOIN steps</a></li>
<li class="chapter" data-level="3.4.3" data-path="hands-on.html"><a href="hands-on.html#inner-join"><i class="fa fa-check"></i><b>3.4.3</b> INNER JOIN</a></li>
<li class="chapter" data-level="3.4.4" data-path="hands-on.html"><a href="hands-on.html#left-join"><i class="fa fa-check"></i><b>3.4.4</b> LEFT JOIN</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="hands-on.html"><a href="hands-on.html#subqueries"><i class="fa fa-check"></i><b>3.5</b> Subqueries</a></li>
<li class="chapter" data-level="3.6" data-path="hands-on.html"><a href="hands-on.html#saving-query-results"><i class="fa fa-check"></i><b>3.6</b> Saving Query Results</a></li>
<li class="chapter" data-level="3.7" data-path="hands-on.html"><a href="hands-on.html#data-management"><i class="fa fa-check"></i><b>3.7</b> Data Management</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="hands-on.html"><a href="hands-on.html#update-tables"><i class="fa fa-check"></i><b>3.7.1</b> Update Tables</a></li>
<li class="chapter" data-level="3.7.2" data-path="hands-on.html"><a href="hands-on.html#add-populate-a-column"><i class="fa fa-check"></i><b>3.7.2</b> Add &amp; Populate a Column</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i>Conclusion</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Intro to SQL for Querying Databases</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="hands-on" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Hands-On</h1>
<div id="viewing-data" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Viewing Data</h2>
<div id="select-from" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> SELECT &amp; FROM</h3>
<p>We’re ready to write our first query! Type this into the <em>SQL Editor Pane</em>:</p>
<p><code>SELECT * FROM users;</code></p>
<p>Place your cursor anywhere on <code>SELECT</code> and then click the <em>Execute query</em> button. <img src="images/Button_Execute.PNG" alt="alt text" /></p>
<p>This is the most common query you’ll write as you start exploring your data. <code>SELECT</code> is used to display the columns of tables you want and <code>FROM</code> is used to specifiy which table to get the columns from.</p>
<p>The query asks the database to select everything (* means “everything”) from the table <em>users</em>. It ends with a semicolon to tell the database that this is the end of the request.</p>
<p>The below query does exactly the same thing as the first one, hence the need for the end of query indicator. We can use new lines to help us organize queries to make them easier to read.</p>
<pre><code>SELECT * 
FROM users;</code></pre>
<blockquote>
<p><strong>NOTE</strong>:<br />
Capitalization in queries follows some best practices:</p>
<ul>
<li>SQL commands are in all caps</li>
<li>Table names and column names are all lowercase</li>
</ul>
</blockquote>
</div>
<div id="selecting-columns" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Selecting Columns</h3>
<p>What if we don’t want to see all of the columns in the table? We can ask for just the columns we want to see. Let’s get the first name, birth date, phone, city, and zip code.</p>
<pre><code>SELECT
    first_name,
    birth_date,
    phone,
    city, 
    zip_code 
FROM users;</code></pre>
<blockquote>
<p><strong>NOTE</strong>:<br />
You can rearrange the columns however you’d like in the <code>SELECT</code> statement and select a column multiple times.</p>
</blockquote>
</div>
<div id="unique-values" class="section level3" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> Unique Values</h3>
<p>In your data exploration, you might want to know which unique values exist in a column. <code>SELECT DISTINCT</code> is the statement we run on one or more columns to achieve this.</p>
<p>Let’s look at the <em>users</em> table again and see which cities our users live in.</p>
<pre><code>SELECT DISTINCT city
FROM users;</code></pre>
<p>If we wanted to see unique combinations across multiple columns, we just add the columns we’re interested in. The query below shows unique city and zip code combinations.</p>
<pre><code>SELECT DISTINCT 
    city, 
    zip_code
FROM users;</code></pre>
</div>
<div id="ordering-results" class="section level3" number="3.1.4">
<h3><span class="header-section-number">3.1.4</span> Ordering Results</h3>
<p>While we continue our data exploration, we also might want to sort the results in a specific way. You can sort on one or more columns with a combination of ascending or descending order using the <code>ORDER BY</code> command.</p>
<p>Let’s sort the <em>users</em> table by birth date.</p>
<pre><code>SELECT *
FROM users
ORDER BY birth_date;</code></pre>
<p>By default, <code>ORDER BY</code> sorts in ascending order. We can sort in descending order to get users born more recently by adding <code>DESC</code> after the column.</p>
<pre><code>SELECT *
FROM users
ORDER BY birth_date DESC;</code></pre>
<blockquote>
<p><strong>CHALLENGE</strong>:<br />
How would you sort <em>users</em> by zip code in descending order and then birth date in ascending order?</p>
</blockquote>
</div>
<div id="limiting-number-of-rows" class="section level3" number="3.1.5">
<h3><span class="header-section-number">3.1.5</span> Limiting Number of Rows</h3>
<p>Sometimes you’ll be working with a large table to analyze with lots of columns and rows. You can use <code>LIMIT</code> to reduce the number of rows the query returns to give you a snapshot of the data you’re working with.</p>
<pre><code>SELECT *
FROM users
LIMIT 10;</code></pre>
</div>
<div id="commenting" class="section level3" number="3.1.6">
<h3><span class="header-section-number">3.1.6</span> Commenting</h3>
<p>As we’re writing queries, sometimes we want to write helpful comments to ourselves and others. There’s two ways to write comments so that text won’t be interpreted as SQL.</p>
<ol style="list-style-type: decimal">
<li>Single line comments: text following two dashses “<em>–</em>”, like so <code>-- comment here</code></li>
<li>Multiline comments: text between the characters “<em>/* */</em>”, like so <code>/* comment here */</code></li>
</ol>
<pre><code>/*
all users in the library system 
sorted by most recent birth date
*/
SELECT *
FROM users
ORDER BY birth_date DESC; -- sort most recent here</code></pre>
<blockquote>
<p><strong>CHECKPOINT</strong>:<br />
Try and use all viewing commands together to give you insight to the dataset. Write your insights in comments.</p>
</blockquote>
</div>
</div>
<div id="filtering-data" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Filtering Data</h2>
<p>Now that we’ve seen some ways to view our data, let’s learn how we can filter our data. This is really the core of SQL, where we can start to answer our own questions about the data!</p>
<p>We use the <code>WHERE</code> command to filter rows of a query by specifying one or more conditions. Below are common operators that can be used and combined with <code>WHERE</code> to create conditions, some of which you may have seen before in other programming languages.</p>
<table>
<thead>
<tr class="header">
<th align="left">Comparison Operators</th>
<th align="left">Arithmetic Operators</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>=</code> (equals)</td>
<td align="left"><code>+</code> (addition)</td>
</tr>
<tr class="even">
<td align="left"><code>&gt;</code> (greater than)</td>
<td align="left"><code>-</code> (subtraction)</td>
</tr>
<tr class="odd">
<td align="left"><code>&gt;=</code> (greater than or equal to)</td>
<td align="left"><code>*</code> (multiplication)</td>
</tr>
<tr class="even">
<td align="left"><code>&lt;</code> (less than)</td>
<td align="left"><code>/</code> (division)</td>
</tr>
<tr class="odd">
<td align="left"><code>&lt;=</code> (less than or equal to)</td>
<td align="left"><code>%</code> (modulus)</td>
</tr>
<tr class="even">
<td align="left"><code>&lt;&gt;</code> or <code>!=</code> (not equal to)</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p><strong>Common Rules</strong>:</p>
<ul>
<li>Comparison operators are used to compare same data type values or columns.
<ul>
<li><em>text_column</em> <code>=</code> <em>text_value</em></li>
<li><em>date_column</em> <code>&gt;</code> <em>date_value</em></li>
<li><em>numeric_column</em> <code>&gt;=</code> <em>numeric_value</em></li>
<li><em>numeric_column</em> <code>&gt;=</code> <em>numeric_column</em></li>
</ul></li>
<li>Arithmetic operators are used with numeric data types or columns.
<ul>
<li><em>numeric_column</em> <code>+</code> <em>numeric_value</em></li>
<li><em>numeric_column1</em> <code>-</code> <em>numeric_column2</em></li>
</ul></li>
<li>When working with <strong>text</strong> or <strong>date</strong> data types, it’s necessary to wrap values in single quotes.
<ul>
<li><em>text_column</em> <code>=</code> <code>'text_value'</code></li>
<li><em>date_column</em> <code>&gt;</code> <code>'2000-01-01'</code></li>
</ul></li>
<li>When working with <strong>numeric</strong> data types, values don’t need to be wrapped in single quotes.
<ul>
<li><em>numeric_column</em> <code>+</code> <code>1</code></li>
</ul></li>
</ul>
<p>Now that we’ve gone through the rules. Let’s write a query to find all users that live in Davis.</p>
<pre><code>SELECT * 
FROM users
WHERE city = &#39;Davis&#39;;</code></pre>
<div id="and-or-operators" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> AND &amp; OR Operators</h3>
<p>In the previous example, we saw a condition with one column, but the power of writing queries is being able to combine multiple conditions.</p>
<p>We can ask <code>WHERE</code> to meet multiple conditions using</p>
<ul>
<li><code>AND</code> (when a record must match both conditions)</li>
<li><code>OR</code> (when a record can match either of two conditions)</li>
</ul>
<p>These are logical operators in SQL that evaluate to TRUE or FALSE.</p>
<p>Let’s find all users who live in Davis <strong><em>and</em></strong> have a zip code of 95616.</p>
<pre><code>SELECT * 
FROM users
WHERE city = &#39;Davis&#39; AND
      zip_code = 95616;</code></pre>
<p>Let’s now find all users who live in Davis <strong><em>or</em></strong> Sacramento.</p>
<pre><code>SELECT * 
FROM users
WHERE city = &#39;Davis&#39; OR
      city = &#39;Sacramento&#39;;</code></pre>
<blockquote>
<p><strong>NOTE</strong>:<br />
<code>AND</code> &amp; <code>OR</code> will follow the order of operations. To use <code>AND</code> &amp; <code>OR</code> in the same query, wrap parenthesis around the <code>OR</code> conditions.</p>
</blockquote>
</div>
<div id="in-operator" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> IN Operator</h3>
<p>Sometimes we find ourselves writing multiple <code>OR</code> conditions on the same column which can make our query look more complex than it really is. In this scenario we can condense multiple <code>OR</code> conditions using <code>IN</code>.</p>
<p>Let’s rewrite our previous query to use <code>IN</code>.</p>
<pre><code>SELECT * 
FROM users
WHERE city IN (&#39;Davis&#39;, &#39;Sacramento&#39;);</code></pre>
</div>
<div id="between-operator" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> BETWEEN Operator</h3>
<p>We can also also filter using ranges of values with <code>BETWEEN</code>. This is handy when you’re working with numerical or date values and you don’t want to list out all possible values to meet your conditions.</p>
<p>Let’s write a query to find all users born in the 1990’s.</p>
<pre><code>SELECT * 
FROM users
WHERE birth_date BETWEEN &#39;1990-01-01&#39; AND &#39;1999-12-31&#39;;</code></pre>
<blockquote>
<p><strong>CHALLENGE</strong>:<br />
Find all users with a zip code from 95000 - 96000.</p>
</blockquote>
</div>
<div id="like-operator" class="section level3" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> LIKE Operator</h3>
<p><code>LIKE</code> is used to search for patterns in strings using the wildcard (<code>%</code>). <code>%</code> is placeholder that means it can match <em>anything</em>. <code>LIKE</code> is case-insensitive.</p>
<p>Let’s look at an example to indicate we want to match the beginning of a string, but the end is allowed to vary. To show this, let’s find users that have a phone number area code that begins with 530 and can end with anything.</p>
<pre><code>SELECT * 
FROM users
WHERE phone LIKE &#39;530%&#39;;</code></pre>
<blockquote>
<p><strong>NOTE</strong>:<br />
The wildcard <code>%</code> can be used multiple times depending on how complicated your pattern is.</p>
<p>You can also use regular expressions in SQLite to match in more complicated situations. Read more about using regular expressions <a href="https://www.sqlite.org/lang_expr.html#regexp">here</a>.</p>
<p><strong>CHALLENGE</strong>:<br />
How would you write a query so that the wild card finds users with an email that ends with icloud.com?</p>
</blockquote>
</div>
<div id="is-null-operator" class="section level3" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span> IS NULL Operator</h3>
<p>So far we’ve worked with complete data, but how do we work with missing data? In databases, <em>NULL</em> means missing data. <code>IS NULL</code> is used to test whether there is missing data in a column.</p>
<p>Let’s look at an example to find users with a missing address.</p>
<pre><code>SELECT * 
FROM users
WHERE address IS NULL;</code></pre>
<blockquote>
<p><strong>CHALLENGE</strong>:<br />
How would you write a query to find users with a missing phone number or missing email?</p>
</blockquote>
</div>
<div id="not-operator" class="section level3" number="3.2.6">
<h3><span class="header-section-number">3.2.6</span> NOT Operator</h3>
<p>There will be times where we want to find the opposite (negate) the conditions we create. To do this we use <code>NOT</code> combined with the other operators like so,</p>
<ul>
<li><code>NOT IN</code></li>
<li><code>NOT BETWEEN</code></li>
<li><code>NOT LIKE</code></li>
<li><code>IS NOT NULL</code></li>
</ul>
<p>Below is a query to find users that <strong><em>do not</em></strong> have a phone number area code that begins with 530.</p>
<pre><code>SELECT * 
FROM users
WHERE phone NOT LIKE &#39;530%&#39;;</code></pre>
</div>
</div>
<div id="aggretating-data" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Aggretating Data</h2>
<p>We’ve just looked at a number of ways to filter data, but now let’s look at some ways to aggregate data.</p>
<div id="count" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Count</h3>
<p>We can count the total number of rows in a table using the <code>COUNT()</code> function. <code>COUNT()</code> takes any column as an argument. Let’s see how many total books have been checked out.</p>
<pre><code>SELECT 
    COUNT(id)
FROM checkouts;</code></pre>
<div id="renamingaliasing-columns" class="section level4" number="3.3.1.1">
<h4><span class="header-section-number">3.3.1.1</span> Renaming/Aliasing Columns</h4>
<p>In the previous query, you’ll notice that the default column name in the result isn’t easy to read or interpret. We can use <code>AS</code> to rename (<em>alias</em>) a column in the result of the query. This is handy if you’re planning to export the result for future use, especially if you’re sending it to someone else.</p>
<p>Let’s rename the column to <em>total_checkouts</em>. This is something interpretable and representative of what it is.</p>
<pre><code>SELECT 
    COUNT(id) AS total_checkouts
FROM checkouts;</code></pre>
<blockquote>
<p><strong>NOTE</strong>:<br />
You can combine <code>DISTINCT</code> with <code>COUNT()</code> using <code>COUNT(DISTINCT column_name)</code> to get a unique count of values in a column when duplicate values exist.</p>
<p><strong>CHALLENGE</strong>:<br />
Find the total number of users that have checked out a book.</p>
</blockquote>
<p>We can also include <code>WHERE</code>. Let’s see how many books were checked out just today.</p>
<pre><code>SELECT 
    COUNT(id) AS total_checkouts
FROM checkouts
WHERE checkout_date = &#39;2022-04-11&#39;;</code></pre>
</div>
</div>
<div id="average" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Average</h3>
<p><code>AVG()</code> is another way to aggregate our data. It returns the average value of a numeric column. Let’s find the average days a person is checking out a book for.</p>
<pre><code>SELECT 
    AVG(days_checking_out) AS avg_days_checking_out
FROM checkouts;</code></pre>
</div>
<div id="sum" class="section level3" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> Sum</h3>
<p>We can also sum the values in a column with <code>SUM()</code>. It returns the total sum of a numeric column. Let’s find the total number of books that were returned with damage.</p>
<pre><code>SELECT 
    SUM(returned_with_damage) AS books_returned_with_damage
FROM checkouts;</code></pre>
<p>Below is another way to accomplish the same task using <code>COUNT()</code> and <code>WHERE</code>.</p>
<pre><code>SELECT 
    COUNT(id) AS books_returned_with_damage
FROM checkouts
WHERE returned_with_damage = 1;</code></pre>
</div>
<div id="grouping-data" class="section level3" number="3.3.4">
<h3><span class="header-section-number">3.3.4</span> Grouping Data</h3>
<p>So now you’ve seen several functions working on a single column, but we sometimes want to summarize our data in more sophisticated ways. Let’s see what grouping can do for our data. Let’s write a query that counts the number of books checked out <strong><em>per day</em></strong>.</p>
<pre><code>SELECT 
    checkout_date, 
    COUNT(book_id) AS books_checked_out
FROM checkouts
GROUP BY checkout_date;</code></pre>
<p>Notice here how we asked for two columns - the <em>checkout_date</em> and the count of <em>book_id</em>.</p>
<blockquote>
<p><strong>CHALLENGE</strong>:<br />
You can also <code>GROUP BY</code> more than one column. How would you find the total number of times a person checked out a book on a given day?</p>
</blockquote>
</div>
<div id="having" class="section level3" number="3.3.5">
<h3><span class="header-section-number">3.3.5</span> Having</h3>
<p><code>HAVING</code> is similar to <code>WHERE</code>, but it specifically works with <code>GROUP BY</code>. Perhaps we’re only interested in days that had more than 5 checkouts. Let’s see what that looks like:</p>
<pre><code>SELECT 
    checkout_date, 
    COUNT(book_id) AS books_checked_out
FROM checkouts
GROUP BY checkout_date
HAVING COUNT(book_id) &gt; 5;</code></pre>
<p>Now we’ve seen how we can use functions to aggregate data and how grouping data can give us meaningful insights. There are, of course, other functions available in SQL and we can’t go over all of them here, but now you’ve seen how they work and can apply your knowledge to new functions you find.</p>
</div>
</div>
<div id="joining-data" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Joining Data</h2>
<p>Joining tables allows us to combine information from more than one table into a new table. The tables need to have a <strong><em>key</em></strong> to do so. In our Library Checkouts ERD, the <em>id</em> column in <em>books</em> is a key column that links to</p>
<ul>
<li><p><em>book_id</em> in <em>checkouts</em></p>
<p>and</p></li>
<li><p><em>book_id</em> in <em>book_genre_link</em></p></li>
</ul>
<div id="join-types" class="section level3" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> JOIN Types</h3>
<p>SQL has 4 main kinds of joins:</p>
<p><img src="https://www.w3schools.com/sql/img_innerjoin.gif" alt="INNER JOIN" /> <img src="https://www.w3schools.com/sql/img_leftjoin.gif" alt="LEFT JOIN" /></p>
<p><img src="https://www.w3schools.com/sql/img_rightjoin.gif" alt="RIGHT JOIN" /> <img src="https://www.w3schools.com/sql/img_fulljoin.gif" alt="FULL OUTER JOIN" /></p>
<blockquote>
<p><strong>NOTE</strong>:<br />
The above images come from the <a href="https://www.w3schools.com/sql/sql_join.asp">W3Schools’ SQL join page</a>, an excellent resource for learning more about SQL.</p>
</blockquote>
<p>What kinds of joins are there?</p>
<ul>
<li><p><code>INNER JOIN</code>: Returns records that have matching values in both tables; it gets you what’s in the middle of the venn diagram.</p></li>
<li><p><code>LEFT JOIN</code>: Returns all records from the left table, and the matched records from the right table; the “left” table is the first table you write in the query.</p></li>
<li><p><code>RIGHT JOIN</code>: Returns all records from the right table, and the matched records from the left table; the “right” table is the second table you write in the query or the “join” table.</p>
<blockquote>
<p><strong>NOTE</strong>:<br />
This is not supported in SQLite, however switching the tables in a <code>LEFT JOIN</code> will emulate a <code>RIGHT JOIN</code>.</p>
</blockquote></li>
<li><p><code>FULL OUTER JOIN</code>: Returns all records when there is a match in either left or right table; nulls are generated in the table when a row in one table doesn’t have a match in the other table.</p>
<blockquote>
<p><strong>NOTE</strong>:<br />
This is not supported in SQLite, however you can emulate a <code>FULL OUTER JOIN</code> described <a href="https://www.sqlitetutorial.net/sqlite-full-outer-join/">here</a>.</p>
</blockquote></li>
</ul>
</div>
<div id="join-steps" class="section level3" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> JOIN steps</h3>
<p>Below are the steps for writing a JOIN:</p>
<ol style="list-style-type: decimal">
<li>We start in just the same way: <code>SELECT</code> the columns we want in the output (using column references).</li>
</ol>
<blockquote>
<p><strong>NOTE</strong>:<br />
Column referencing helps you distinguish from what table the columns come from. Use the table name followed by a period to reference the column: <code>table_name.column_name</code>.</p>
</blockquote>
<ol start="2" style="list-style-type: decimal">
<li>Then we have the <code>FROM</code> statement to tell it which table to start with (this is our “left” table).</li>
<li>Then we need our <code>JOIN</code> statement to say which table should get joined (this is our “right” table)</li>
<li>Finally, we have to say which columns the join should be based on with <code>ON</code> .</li>
</ol>
</div>
<div id="inner-join" class="section level3" number="3.4.3">
<h3><span class="header-section-number">3.4.3</span> INNER JOIN</h3>
<p>Let’s try an <code>INNER JOIN</code> to see how this works:</p>
<pre><code>SELECT 
    checkouts.user_id,
    books.title AS book,
    checkouts.checkout_date
FROM books
    INNER JOIN checkouts ON books.id = checkouts.book_id;</code></pre>
<p>We interpret the <code>INNER JOIN</code> query as, “all books that have been checked out.”</p>
<blockquote>
<p><strong>NOTE</strong>:<br />
Notice that you can alias a table and columns in the same query. This will come handy when we learn about <code>JOIN</code>!</p>
<p><strong>CHALLENEGE</strong>:<br />
How would you reference the columns when the table is aliased? Can you use <em>users</em>, <em>students</em>, or both?</p>
</blockquote>
</div>
<div id="left-join" class="section level3" number="3.4.4">
<h3><span class="header-section-number">3.4.4</span> LEFT JOIN</h3>
<p>Now let’s try a <code>LEFT JOIN</code>:</p>
<pre><code>SELECT 
    checkouts.user_id,
    books.title AS book,
    checkouts.checkout_date
FROM books
    LEFT JOIN checkouts ON books.id = checkouts.book_id;</code></pre>
<p>We interpret the <code>LEFT JOIN</code> query as, “all books and if they have been checked out or not.”</p>
<p>You might be thinking, what would happed if the tables in the <code>LEFT JOIN</code> were flipped? We would get the same result as the <code>INNER JOIN</code> query! That’s because there’s no instances where a checkout without a book could ever happen!</p>
<blockquote>
<p><strong>CHALLENGE</strong>:<br />
Can you write a query that contains the title of the books and the names of the genres they’re categorized to?</p>
</blockquote>
</div>
</div>
<div id="subqueries" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Subqueries</h2>
<p>So far we’ve been working with one <code>SELECT</code> statement, but we can actually combine multiple <code>SELECT</code> statements using subqueries. Subqueries are nested queries enclosed in parentheses that can be used with other commands like <code>JOIN</code> and <code>WHERE</code>. Below are 2 examples of these use cases.</p>
<p>Let’s first look at a subquery in the <code>WHERE</code> clause:</p>
<pre><code>-- main query
SELECT * 
FROM checkouts
WHERE book_id IN (
    -- subquery
    SELECT id
    FROM books
    WHERE format = &#39;Hardcover&#39;
);</code></pre>
<p>We retrieve hardcover books in a subquery. We then use the results of the subquery to filter the <em>checkouts</em> table using <em>checkouts.book_id</em>. In the end we get, “all checked out hardcover books.”</p>
<blockquote>
<p><strong>NOTE</strong>:<br />
When writing a subquery with <code>WHERE</code> and <code>IN</code>, the subquery must select only one column for <code>IN</code> to filter on.</p>
</blockquote>
<p>Now let’s look at a subquery with <code>JOIN</code>:</p>
<pre><code>-- main query
SELECT 
    checkouts.user_id,
    hardcover_books.title AS book,
    checkouts.checkout_date,
    checkouts.return_date
FROM checkouts
    INNER JOIN (
        -- subquery
        SELECT *
        FROM books
        WHERE format = &#39;Hardcover&#39;
    ) AS hardcover_books ON checkouts.book_id = hardcover_books.id;</code></pre>
<p>We retrieve hardcover books in a subquery, just like before. Next, we write the subquery after <code>JOIN</code> and alias it <em>hardcover_books</em>. Finally, we join on the keys and return the columns we want in the main <code>SELECT</code> statement.</p>
<blockquote>
<p><strong>NOTE</strong>:<br />
If you’re still a bit confused, just remember that every query results in a table. Subqueries give you the ability to create a “new” table on the fly even if that table didn’t exist in the database before.</p>
<p>Also, note that both subquery examples are just different ways to get to the same result, “checked out hardcover books.”</p>
</blockquote>
</div>
<div id="saving-query-results" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> Saving Query Results</h2>
<p>There will be times when we want to save the results of a query so we can reuse it later when needed. Two commands to save a query as a new database object follow:</p>
<ol style="list-style-type: decimal">
<li><code>CREATE TEMPORARY TABLE</code>
<ul>
<li>This is a new table added to the database, just like the tables you’ve been working with, except it is only available in the current session. You typically do this to break down a complex problem into intermediate steps and pass your saved results to the final query.</li>
</ul></li>
<li><code>CREATE VIEW</code>
<ul>
<li>A view is simply a saved query that can be executed when called. The query you save will usually be made up of multiple tables with added conditions if needed. You can use it in pretty much the same way you would a table. The only major difference is that a view, because it is updating from other tables, is not able to be edited.</li>
</ul></li>
</ol>
<p>If we want to create a temporary table, we just need to add <code>CREATE TEMPORARY TABLE our_new_table_name AS</code> at the beginning of the query (adding in our own table name, of course). This is what it looks like:</p>
<pre><code>CREATE TEMPORARY TABLE davis_resident_checkouts AS
    SELECT 
        users.id AS user_id,
        users.first_name,
        users.last_name,
        books.title AS book,
        checkouts.checkout_date,
        checkouts.return_date
    FROM users
        INNER JOIN checkouts ON users.id = checkouts.user_id
        INNER JOIN books ON checkouts.book_id = books.id
    WHERE users.city = &#39;Davis&#39;;</code></pre>
<p>In much the same way we made the new table, we can make a view:</p>
<pre><code>CREATE VIEW davis_resident_checkouts AS
    SELECT 
        users.id AS user_id,
        users.first_name,
        users.last_name,
        books.title AS book,
        checkouts.checkout_date,
        checkouts.return_date
    FROM users
        INNER JOIN checkouts ON users.id = checkouts.user_id
        INNER JOIN books ON checkouts.book_id = books.id
    WHERE users.city = &#39;Davis&#39;;</code></pre>
</div>
<div id="data-management" class="section level2" number="3.7">
<h2><span class="header-section-number">3.7</span> Data Management</h2>
<div id="update-tables" class="section level3" number="3.7.1">
<h3><span class="header-section-number">3.7.1</span> Update Tables</h3>
<p>You might have noticed at the beginning the <em>users</em> table has <em>NULL</em> values across different columns. We can fix this fairly easily, but we need to be careful. It’s challenging to undo something in a database so we want to be sure we’re doing it right. Let’s update the <em>NULL</em> values in the <em>users.address</em> to “<em>N/A</em>”.</p>
<p>It’s first helpful to write a query to be sure these are the records you want to update:</p>
<pre><code>SELECT *
FROM users
WHERE address IS NULL;</code></pre>
<p>Once you’ve confirmed, the below statement updates the <em>NULL</em> values to “<em>N/A</em>”</p>
<pre><code>UPDATE users
SET address = &#39;N/A&#39;
WHERE address IS NULL;</code></pre>
<p>The <code>SET</code> command specifically targets just the <em>address</em> column and replaces <em>NULL</em> values with “<em>N/A</em>” when the condition is met in the <code>WHERE</code> clause. It leaves the other values alone. If the <code>WHERE</code> clause is removed, it will set all values in the whole column to “<em>N/A</em>” overwriting the users address, so proceed with caution!</p>
</div>
<div id="add-populate-a-column" class="section level3" number="3.7.2">
<h3><span class="header-section-number">3.7.2</span> Add &amp; Populate a Column</h3>
<p>Sometimes we want to make a new column and add data into it. Let’s make a new column called <em>country</em> in the <em>users</em> table and populate it with “<em>USA</em>” if there is a value in the column <em>state</em>.</p>
<p>First we’ll add the column and set the default value to “<em>N/A</em>”:</p>
<pre><code>ALTER TABLE users
ADD country TEXT DEFAULT &#39;N/A&#39;;</code></pre>
<blockquote>
<p><strong>NOTE</strong>:<br />
The <code>DEFAULT</code> argument is optional, but if you leave it blank, it will make the default value <em>NULL</em>.</p>
</blockquote>
<p>Now we update all values in the column to be “<em>USA</em>” where the state is not null.</p>
<pre><code>UPDATE users
SET country = &#39;USA&#39;
WHERE state IS NOT NULL;</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-background-and-setup.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="conclusion.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ucdavisdatalab/workshop_intro_to_sql/edit/master/03_hands-on.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/ucdavisdatalab/workshop_intro_to_sql/blob/master/03_hands-on.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
